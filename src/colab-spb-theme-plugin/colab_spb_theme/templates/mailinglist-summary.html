{% extends 'base.html' %}
{% load i18n tz superarchives %}

{% block title %}{{ mailinglist.name|title }} - Listas de discussão - SPB{% endblock %}

{% block main-content %}
  <div class="colab-content container">
  {% block mailinglist_view_title %}
    <div class="row">
      <div class="col-md-12">
        <h2>Listas de discussão</h2>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        <h3><b class="colab-mailinglist-name">{{ mailinglist.name|title }} {% if mailinglist.description %}({{ mailinglist.description }}){% endif %}</b></h3>
        <div class="btn-group btn-group-sm btn-colab-mailinglist-members">
          <a href="#" class="btn btn-default" disabled="disabled">{% blocktrans with number_of_users=mailinglist.get_number_of_users %}{{ number_of_users }} members{% endblocktrans %}</a>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-8">
        {% with total=page_obj.paginator.count %}
          <span class="colab-thread-total"><b>Total de {{ total }} tópico{{ total|pluralize }} na lista de discussão</b></span>
        {% endwith %}
      </div>
      <div class="col-md-4">
        <form method="get" class="pull-right">
          <span class="colab-thread-order"><b>{% trans "Order by" %}:</b></span>
          <select name="order" class="colab-thread-order-select" id="order_option" onchange="this.form.submit()">
            {% for option, dict_order in order_data.items %}
              {% ifequal selected option %}
                <option value="{{option}}" selected>{% trans dict_order.name %}</option>
              {% else %}
                <option value="{{option}}">{% trans dict_order.name %}</option>
              {% endifequal %}
            {% endfor %}
          </select>
        </form>
      </div>
    </div>
    <hr/>
  {% endblock %}

  {% block mailinglist_view_thread_list %}
    <div class="row">
      <div class="list-container">
        <div class="col-md-8">
          <div class="thread-list">
            <div style="border-right: 1px solid #ccc; padding-right: 32px; min-height: 450px">
              {% for thread in thread_list %}
              <div class="row colab-thread">
                <div class="col-md-12 colab-thread">
                  <small class="colab-thread-modified-time">{{ thread.latest_message.received_time|date:"d F Y" }} {% trans "at" %} {{thread.latest_message.received_time|date:"h:m" }} - <a class="colab-thread-modified-author" href="{{thread.latest_message.author_url}}">{{thread.latest_message.author }}</a>
                  </small><br>
                  <h4><a class="colab-thread-subject" href="{{thread.get_absolute_url}}">{{ thread.latest_message.subject_clean }}</h4>
                    {% with thread.latest_message.body|truncatechars:"85" as description %}
                    <span class="colab-thread-latest-message">{{description | default_if_none:"a"}}</span></a><br>
                    {% endwith %}
                    <hr/>
                  </div>
                </div>
                {% endfor %}
              </div>
          </div>
        </div>

        <div class="col-md-4">
          <div class="mailinglist-help">
            <p>Em caso de dúvidas, visite o <a href="/social/spb/ajuda#faq">Guia de Uso</a></p>
            <hr>
            <p>Caso ainda permaneça com dúvidas, fique à vontade para entrar em contato conosco através do email: <a href="mailto:admin@softwarepublico.gov.br">admin@softwarepublico.gov.br</a></p>
          </div>
        </div>
      </div>
    </div>
  {% endblock %}

  {% block mailinglist_view_paginator %}
    {% if page_obj.has_other_pages %}
      <div class="text-center">
        <ul class="pagination">
          <li {% if page_obj.number == 1 %}class="disabled"{% endif %}>
            <a href="{% if page_obj.number == 1 %}javascript:void(0);{% else %}?page={{1}}{% endif %}"><span class="glyphicon glyphicon-chevron-left small-icon"></span><span class="glyphicon glyphicon-chevron-left small-icon"></span></a>
          </li>
          <li {% if not page_obj.has_previous %}class="disabled"{% endif %}>
            <a href="{% if page_obj.has_previous %}?page={{page_obj.previous_page_number }}{% else %}javascript:void(0);{% endif %}"><span class="glyphicon glyphicon-chevron-left small-icon"></span></a>
          </li>

          {% if page_obj.has_previous %}
            {% if page_obj.previous_page_number > 1 %}
              <li>
                <a href="?page={{page_obj.previous_page_number|add:-1 }}">{{ page_obj.number|add:-2 }}</a>
              </li>
            {% endif %}
            <li>
              <a href="?page={{page_obj.previous_page_number }}">{{ page_obj.number|add:-1 }}</a>
            </li>
          {% endif %}

          <li class="active">
            <a href="javascript:void(0);">{{ page_obj.number }}</a>
          </li>

          {% if page_obj.has_next %}
            <li>
              <a href="?page={{page_obj.next_page_number }}">{{ page_obj.number|add:1 }}</a>
            </li>
            {% if page_obj.next_page_number < page_obj.paginator.num_pages %}
              <li>
                <a href="?page={{page_obj.next_page_number|add:1 }}">{{ page_obj.number|add:2 }}</a>
              </li>
            {% endif %}
          {% endif %}

          <li {% if not page_obj.has_next %}class="disabled"{% endif %}>
            <a href="{% if page_obj.has_next %}?page={{page_obj.next_page_number }}{% else %}javascript:void(0);{% endif %}"><span class="glyphicon glyphicon-chevron-right small-icon"></span></a>
          </li>

          <li {% if page_obj.number == page_obj.paginator.num_pages %}class="disabled"{% endif %}>
            <a href="{% if page_obj.number == page_obj.paginator.num_pages %}javascript:void(0);{% else %}?page={{page_obj.paginator.num_pages }}{% endif %}"><span class="glyphicon glyphicon-chevron-right small-icon"></span><span class="glyphicon glyphicon-chevron-right small-icon"></span></a>
          </li>

        </ul>
      </div>
    {% endif %}
  {% endblock %}
  </div>

  <script>
  $(function() {
    var $sidebar = $(".mailinglist-help"),
      $window = $(window),
      offset = $sidebar.offset(),
      maxMarginTop = $(".list-container .thread-list").height() - $sidebar.height();

    $window.scroll(function() {
      if($window.scrollTop() > offset.top) {
        var marginTop = $window.scrollTop() - offset.top;
        marginTop = marginTop > maxMarginTop ? maxMarginTop : marginTop;

        $sidebar.stop().animate({
          marginTop: marginTop
        });
      } else {
        $sidebar.stop().animate({
          marginTop: 0
        });
      }
    });
  });
  </script>

{% endblock %}
